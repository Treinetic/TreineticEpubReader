<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treinetic Epub Reader - Modern Demo</title>
    <!-- Demo UI CSS -->
    <link rel="stylesheet" href="demo.css">
    <!-- Library CSS (Built) -->
    <link rel="stylesheet" href="../dist/style.css">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <!-- 
      DEMO Structure
      Loads the built library and the demo logic.
    -->
    <script src="../dist/treinetic-epub-reader.umd.js"></script>
    <script src="demo.js"></script>
    <div id="split-container" style="display:flex; height:100vh; width:100vw; overflow:hidden;">

        <!-- SECTION A: CONTROLS -->
        <div id="section-a" class="sidebar-panel"
            style="width:250px; min-width:200px; display:flex; flex-direction:column; padding:10px; box-sizing:border-box; overflow-y:auto;">
            <h3 class="sidebar-title">Treinetic Reader <span style="font-size:10px; opacity:0.6;">v2.0</span></h3>

            <!-- Group 1: Library -->
            <details open>
                <summary>Library</summary>
                <div class="control-group">
                    <select id="book-selector" class="ui-select">
                        <option value="/demo/public/epubs/alice.epub">Alice in Wonderland</option>
                        <option value="/demo/public/epubs/sherlock.epub">Sherlock Holmes</option>
                        <option value="/demo/public/epubs/moby-dick.epub">Moby Dick</option>
                        <option value="/demo/public/epubs/frankenstein.epub">Frankenstein</option>
                    </select>
                </div>
            </details>

            <!-- Group 2: Navigation -->
            <details open>
                <summary>Navigation</summary>
                <div class="control-group row">
                    <button id="btn-prev" class="btn-ui flex-1">
                        <i class="fas fa-chevron-left"></i> Prev
                    </button>
                    <button id="btn-next" class="btn-ui flex-1">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </details>

            <!-- Group 3: Appearance -->
            <details open>
                <summary>Appearance</summary>

                <!-- Font Size -->
                <div class="control-group row">
                    <button id="btn-font-dec" class="btn-icon"><i class="fas fa-minus"></i></button>
                    <span id="font-val" class="font-display">100%</span>
                    <button id="btn-font-inc" class="btn-icon"><i class="fas fa-plus"></i></button>
                </div>

                <!-- Themes -->
                <div class="control-label">Reading Theme</div>
                <div class="control-group row wrap">
                    <button class="swatch" data-theme="default-theme" title="Day">D</button>
                    <button class="swatch" data-theme="night-theme" title="Night">N</button>
                    <button class="swatch" data-theme="parchment-theme" title="Sepia">S</button>
                    <button class="swatch swatch-kindle-paper" data-theme="kindle-paper-theme"
                        title="Kindle Paper">K</button>
                    <button class="swatch" data-theme="custom-pink-theme" style="background: hotpink;"
                        title="Custom">?</button>
                </div>
                <!-- Scroll Mode -->
                <div class="control-group" style="margin-top: 10px;">
                    <button id="btn-toggle-scroll" class="btn-ui full-width">
                        <i class="fas fa-scroll"></i> &nbsp; Toggle Scroll Mode
                    </button>
                </div>
            </details>

            <div style="flex:1;">
                <strong>Table of Contents</strong>
                <ul id="toc-list" style="padding-left:15px; margin-top:5px; font-size:14px;">
                    <li>Loading...</li>
                </ul>
            </div>
        </div>

        <!-- RESIZER -->
        <div id="resizer"
            style="width:8px; cursor:col-resize; background:#e0e0e0; border-left:1px solid #ccc; border-right:1px solid #ccc;">
        </div>

        <!-- SECTION B: READER -->
        <div id="section-b"
            style="flex:1; position:relative; overflow:hidden; background:#eee; padding:20px 0; box-sizing:border-box; display:flex; flex-direction:column; justify-content: center;">

            <!-- DEMO: Screen Width Indicator -->
            <div id="width-indicator" style="
                position: absolute; 
                top: 10px; 
                left: 50%; 
                transform: translateX(-50%); 
                background: rgba(0,0,0,0.7); 
                color: #fff; 
                padding: 5px 10px; 
                border-radius: 15px; 
                font-size: 12px; 
                pointer-events: none;
                z-index: 100;
                font-family: sans-serif;">
                Width: 0px
            </div>
            <!-- Inner Wrapper for Reader Area -->
            <!-- User Request: Add Padding for Content Spacing (20px all sides) -->
            <!-- User Request: Add Padding for Content Spacing (Responsive) -->
            <div id="demo-wrapper">
                <!-- The Reader Frame -->
                <div id="epub-reader-frame" style="width:100%; height:100%;"></div>
            </div>
        </div>
    </div>

    <!-- Resizer Logic -->
    <script>
        // Width Indicator Logic (Tracks Container Width & Computed Padding)
        const indicator = document.getElementById('width-indicator');
        const sectionB = document.getElementById('section-b');
        // FIX: Measure the actual library element which now has the padding
        const readerElement = document.getElementById('epub-reader-frame');

        if (indicator && sectionB && readerElement) {
            const observer = new ResizeObserver(entries => {
                for (let entry of entries) {
                    const width = Math.round(entry.contentRect.width);

                    // Display Computed Padding
                    // FIX: Measure the internal wrapper which now holds the padding
                    const internalWrapper = readerElement.querySelector('.tr-internal-wrapper');
                    let padding = '0px';

                    if (internalWrapper) {
                        const computedStyle = window.getComputedStyle(internalWrapper);
                        padding = computedStyle.paddingTop; // Assumes uniform
                    } else {
                        // Fallback purely for debug if wrapper not ready yet
                        const computedStyle = window.getComputedStyle(readerElement);
                        padding = computedStyle.paddingTop;
                    }

                    indicator.textContent = `Width: ${width}px | Padding: ${padding}`;
                }
            });
            observer.observe(sectionB);
        }

        const resizer = document.getElementById('resizer');
        const leftSide = document.getElementById('section-a');
        let x = 0;
        let leftWidth = 0;

        const mouseDownHandler = function (e) {
            x = e.clientX;
            leftWidth = leftSide.getBoundingClientRect().width;
            document.addEventListener('mousemove', mouseMoveHandler);
            document.addEventListener('mouseup', mouseUpHandler);
            // Disable iframe pointer events while dragging to prevent capture
            document.getElementById('epub-reader-frame').style.pointerEvents = 'none';
        };

        const mouseMoveHandler = function (e) {
            const dx = e.clientX - x;
            leftSide.style.width = `${leftWidth + dx}px`;
        };

        const mouseUpHandler = function () {
            document.removeEventListener('mousemove', mouseMoveHandler);
            document.removeEventListener('mouseup', mouseUpHandler);
            document.getElementById('epub-reader-frame').style.pointerEvents = 'auto';
        };

        resizer.addEventListener('mousedown', mouseDownHandler);
    </script>

    <!-- Legacy Dependencies -->


</body>

</html>